---
phase: 02-schema-additions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/schema/RestaurantSchema.astro
autonomous: true
requirements:
  - SCHM-05
  - SCHM-06
  - SCHM-07
  - SCHM-08

must_haves:
  truths:
    - 'RestaurantSchema JSON-LD contains a geo property with latitude 35.22291449138381 and longitude -112.47815397255074'
    - 'RestaurantSchema JSON-LD contains an areaServed array with 12 Place/City entries starting with Ash Fork and ending with Historic Route 66, Arizona'
    - 'RestaurantSchema JSON-LD contains an aggregateRating derived from reviews.json with ratingValue and reviewCount computed at build time (not hardcoded)'
    - 'RestaurantSchema JSON-LD contains hasMap, potentialAction (OrderAction with Toast URL), and containedInPlace (Historic Route 66)'
  artifacts:
    - path: 'src/components/schema/RestaurantSchema.astro'
      provides: 'Restaurant JSON-LD with geo, areaServed, aggregateRating, hasMap, potentialAction, containedInPlace'
      contains: 'GeoCoordinates'
  key_links:
    - from: 'src/components/schema/RestaurantSchema.astro'
      to: 'src/data/reviews.json'
      via: 'import for aggregateRating computation'
      pattern: "import.*reviews\\.json"
---

<objective>
Add geo coordinates, expanded areaServed array, aggregateRating (computed from reviews.json), hasMap, potentialAction (OrderAction), and containedInPlace to RestaurantSchema.astro.

Purpose: These five missing local SEO signals are critical for AI/answer engine consumption and Google's entity understanding of the restaurant's location, service area, rating, ordering capability, and geographic context on Route 66.

Output: Updated RestaurantSchema.astro with six new schema.org properties passing TypeScript type checks and producing valid JSON-LD.
</objective>

<execution_context>
@/Users/moni/.claude/get-shit-done/workflows/execute-plan.md
@/Users/moni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-schema-additions/02-CONTEXT.md
@.planning/phases/02-schema-additions/02-RESEARCH.md
@src/components/schema/RestaurantSchema.astro
@src/data/reviews.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add geo, areaServed, aggregateRating, hasMap, potentialAction, and containedInPlace to RestaurantSchema.astro</name>
  <files>src/components/schema/RestaurantSchema.astro</files>
  <action>
Edit the existing RestaurantSchema.astro to add six new properties to the Restaurant JSON-LD schema object. Keep all existing properties unchanged.

**Import additions (frontmatter top):**

- Add `import reviewsData from '../../data/reviews.json';` for aggregateRating computation.
- Expand the schema-dts type import to include needed sub-types: `Restaurant, GeoCoordinates, Place, AggregateRating, OrderAction, WithContext` — only add types needed to suppress TypeScript errors. If TypeScript is happy with the inline objects without explicit sub-type imports, leave the import minimal.

**Compute aggregateRating snapshot (frontmatter, before schema const):**

```typescript
const ratedReviews = reviewsData.filter((r: { rating?: number }) => typeof r.rating === 'number');
const ratingValue =
  ratedReviews.length > 0
    ? parseFloat(
        (
          ratedReviews.reduce((sum: number, r: { rating: number }) => sum + r.rating, 0) /
          ratedReviews.length
        ).toFixed(1)
      )
    : 0;
const reviewCount = ratedReviews.length;
```

Note: aggregateRating serves AEO/AI engines — Google does NOT show star snippets for self-hosted LocalBusiness reviews (2019 policy). Do NOT add code comments promising star snippets.

**Add these properties to the schema object (after existing `areaServed: 'Ash Fork'` — replace that line):**

1. **geo (SCHM-05):**

```typescript
geo: {
  '@type': 'GeoCoordinates',
  latitude: 35.22291449138381,
  longitude: -112.47815397255074,
},
```

2. **areaServed (SCHM-06) — replaces existing `areaServed: 'Ash Fork'`:**
   12 entries, Ash Fork first, remaining by distance from restaurant. Use `@type: 'City'` for towns, `@type: 'Place'` for route/corridor concepts. Add Wikipedia `@id` only for towns with known Wikipedia articles (Ash Fork, Williams, Seligman, Prescott, Prescott Valley, Sedona). Omit `@id` for Kaibab Estates West, Crookton, Paulden, Grand Canyon South Rim, I-40 Corridor, Historic Route 66.

```typescript
areaServed: [
  { '@type': 'City', name: 'Ash Fork', '@id': 'https://en.wikipedia.org/wiki/Ash_Fork,_Arizona' },
  { '@type': 'City', name: 'Williams', '@id': 'https://en.wikipedia.org/wiki/Williams,_Arizona' },
  { '@type': 'City', name: 'Kaibab Estates West' },
  { '@type': 'City', name: 'Crookton' },
  { '@type': 'City', name: 'Seligman', '@id': 'https://en.wikipedia.org/wiki/Seligman,_Arizona' },
  { '@type': 'City', name: 'Paulden' },
  { '@type': 'City', name: 'Prescott', '@id': 'https://en.wikipedia.org/wiki/Prescott,_Arizona' },
  { '@type': 'City', name: 'Prescott Valley', '@id': 'https://en.wikipedia.org/wiki/Prescott_Valley,_Arizona' },
  { '@type': 'City', name: 'Sedona', '@id': 'https://en.wikipedia.org/wiki/Sedona,_Arizona' },
  { '@type': 'Place', name: 'Grand Canyon South Rim' },
  { '@type': 'Place', name: 'I-40 Corridor, Arizona' },
  { '@type': 'Place', name: 'Historic Route 66, Arizona' },
],
```

Flagstaff is explicitly EXCLUDED per user decision.

3. **aggregateRating (SCHM-07):**

```typescript
aggregateRating: {
  '@type': 'AggregateRating',
  ratingValue,
  reviewCount,
  bestRating: 5,
  worstRating: 1,
},
```

4. **hasMap (SCHM-08):**

```typescript
hasMap: 'https://maps.app.goo.gl/q2EJFMbMRaysU6vH8',
```

5. **potentialAction (SCHM-08):**

```typescript
potentialAction: {
  '@type': 'OrderAction',
  target: 'https://order.toasttab.com/online/spice-grill-bar-33-lewis-ave',
},
```

6. **containedInPlace (SCHM-08):**

```typescript
containedInPlace: {
  '@type': 'Place',
  name: 'Historic Route 66',
  url: 'https://en.wikipedia.org/wiki/U.S._Route_66',
},
```

**TypeScript handling:** If `npm run typecheck` fails due to schema-dts type inference issues with the areaServed array or any sub-object, use explicit type annotations on intermediate variables (e.g., `as Place[]`) or cast narrowly. Do NOT use `as unknown as` broadly — fix the specific type mismatch. Run `npm run typecheck` to validate.

**Preserve:** The existing `<script is:inline type="application/ld+json" set:html={JSON.stringify(schema)} />` template line unchanged.
</action>
<verify>

1. `npm run typecheck` passes with zero errors
2. `npm run build` succeeds
3. Inspect `dist/index.html` and confirm the Restaurant JSON-LD contains: geo with latitude/longitude, areaServed as a 12-element array, aggregateRating with ratingValue and reviewCount, hasMap URL, potentialAction with OrderAction, containedInPlace with Historic Route 66
4. Confirm aggregateRating values are computed (ratingValue=5.0, reviewCount=7 based on current reviews.json) — NOT hardcoded literals in the source
   </verify>
   <done>
   RestaurantSchema.astro emits valid JSON-LD with all six new properties. TypeScript type checks pass. The aggregateRating is derived from reviews.json at build time. The areaServed array has exactly 12 entries with correct @type (City vs Place) and Wikipedia @id where applicable.
   </done>
   </task>

</tasks>

<verification>
1. `npm run typecheck` — zero errors
2. `npm run build` — succeeds without warnings
3. `npm run test:quality` — lint, knip, typecheck, AEO audit all pass
4. Inspect built JSON-LD in dist/index.html for all six new properties with correct values
</verification>

<success_criteria>

- RestaurantSchema JSON-LD in the built page contains geo, areaServed (12 entries), aggregateRating (computed from reviews.json), hasMap, potentialAction (OrderAction), and containedInPlace
- `npm run typecheck` and `npm run build` pass cleanly
- No hardcoded ratingValue or reviewCount in source code — values derived from reviews.json import
  </success_criteria>

<output>
After completion, create `.planning/phases/02-schema-additions/02-01-SUMMARY.md`
</output>
